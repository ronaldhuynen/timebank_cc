<?php

namespace App\Services;

use Elastic\Elasticsearch\ClientBuilder;
use Illuminate\Support\Facades\Artisan;

class ElasticsearchService
{
    protected $client;

    public function __construct()
    {
        $this->client = ClientBuilder::create()->build();
    }

    /**
     * Create the index in Elasticsearch.
     *
     * @return void
     */
    public function createIndex()
    {
        $stopwords = config('timebank-cc.elasticsearch.stopwords');

        $settings = [
            'analysis' => [
                'analyzer' => [
                    'my_custom_analyzer' => [
                        'type' => 'standard',
                        'stopwords' => $stopwords
                    ]
                ]
            ]
        ];

        $params = [
            'index' => 'my_index',
            'body' => [
                'settings' => $settings,
                // other index settings...
            ]
        ];

        $response = $this->client->indices()->create($params);

        // // Flush the old models from the index
        // Artisan::call('scout:flush');
        // // Import the models for Scout
        // Artisan::call('scout:import');

        return $response;
    }
}
